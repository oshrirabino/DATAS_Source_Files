<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Log Parsing & Tree Visualization Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f0f0f0;
        }
        
        .test-container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .tree-display {
            width: 100%;
            height: 500px;
            border: 2px solid #333;
            background: #f9f9f9;
            position: relative;
            overflow: hidden;
            margin: 20px 0;
        }
        
        .tree-node {
            position: absolute;
            width: 60px;
            height: 60px;
            background: #4CAF50;
            border: 2px solid #333;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 10;
        }
        
        .tree-node:hover {
            transform: scale(1.1);
            background: #45a049;
        }
        
        .tree-connection {
            position: absolute;
            height: 2px;
            background: #333;
            transform-origin: left center;
            z-index: 5;
        }
        
        .tree-caption {
            position: fixed;
            top: 100px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 0, 0, 0.9);
            color: white;
            padding: 15px 25px;
            border-radius: 20px;
            font-size: 18px;
            font-weight: bold;
            z-index: 10000;
            opacity: 1;
            transition: opacity 0.3s ease;
            pointer-events: none;
            border: 3px solid yellow;
        }
        
        .log-input {
            width: 100%;
            height: 200px;
            font-family: monospace;
            font-size: 12px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            margin: 10px 0;
        }
        
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        
        button:hover {
            background: #0056b3;
        }
        
        .log-output {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 10px;
            height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
        
        .sample-logs {
            background: #e9ecef;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        
        .sample-logs h4 {
            margin-top: 0;
        }
        
        .sample-logs pre {
            background: white;
            padding: 10px;
            border-radius: 3px;
            overflow-x: auto;
            font-size: 11px;
        }
    </style>
</head>
<body>
    <h1>üîç Log Parsing & Tree Visualization Test</h1>
    
    <div class="test-container">
        <h2>Test Controls</h2>
        <button onclick="testBTreeParsing()">Test B-Tree Parsing</button>
        <button onclick="testAVLTreeParsing()">Test AVL Tree Parsing</button>
        <button onclick="testCustomLogs()">Test Custom Logs</button>
        <button onclick="loadFullBTreeLogs()">Load Full B-Tree Logs</button>
        <button onclick="loadFullAVLLogs()">Load Full AVL Logs</button>
        <button onclick="clearTree()">Clear Tree</button>
        <button onclick="clearLog()">Clear Log</button>
    </div>
    
    <div class="test-container">
        <h2>Custom Log Input</h2>
        <p>Paste your server logs here to test parsing:</p>
        <textarea id="custom-logs" class="log-input" placeholder="Paste server logs here..."></textarea>
        <button onclick="parseCustomLogs()">Parse Custom Logs</button>
    </div>
    
    <div class="test-container">
        <h2>Sample Logs</h2>
        <div class="sample-logs">
            <h4>Real Server Logs (from logs.txt):</h4>
            <pre id="real-logs-sample">INIT_SUCCESS order=4 size=0
READY order=4
INSERT_SUCCESS value=5 new_size=1
[TREE_INSERT] value=5 root=0x63a140872460
[NODE_STATE] ROOT_BEFORE_INSERT node=0x63a140872460 is_leaf=true keys_count=0 children_count=0 keys=[] children=[]
[Insert Val] node=0x63a140872460 value=5
[NODE_STATE] BEFORE_INSERT node=0x63a140872460 is_leaf=true keys_count=0 children_count=0 keys=[] children=[]
[find Index] search index for val=5 in node=0x63a140872460: found index=0
[Insert Leaf] node=0x63a140872460 inserting key=5 at index=0
[NODE_STATE] AFTER_INSERT_LEAF node=0x63a140872460 is_leaf=true keys_count=1 children_count=0 keys=[5] children=[]
[TREE_INSERT_COMPLETE] value=5 root=0x63a140872460
[NODE_STATE] ROOT_AFTER_INSERT node=0x63a140872460 is_leaf=true keys_count=1 children_count=0 keys=[5] children=[]</pre>
            <button onclick="loadRealLogsSample()">Load Real Server Logs</button>
        </div>
        
        <div class="sample-logs">
            <h4>Real AVL Tree Logs (from logs2.txt):</h4>
            <pre id="avltree-sample">INIT_SUCCESS type=AVL size=0
READY type=AVL
INSERT_SUCCESS value=6 new_size=1
[TREE_INSERT] value=6
[ROOT_CREATE] address=0x64cd886b1d10 value=6
INSERT_SUCCESS value=7 new_size=2
[TREE_INSERT] value=7
[INSERT] node=0x64cd886b1d10 value=7 direction=right
[NODE_CREATE] address=0x64cd886b1d50 value=7
[POINTER_CHANGE] 0x64cd886b1d10.right=0x64cd886b1d50
INSERT_SUCCESS value=89 new_size=3
[TREE_INSERT] value=89
[INSERT] node=0x64cd886b1d10 value=89 direction=right
[INSERT] node=0x64cd886b1d50 value=89 direction=right
[NODE_CREATE] address=0x64cd886b1f20 value=89
[POINTER_CHANGE] 0x64cd886b1d50.right=0x64cd886b1f20
[ROTATE_LEFT] node=0x64cd886b1d10 right=0x64cd886b1d50 right_left=0
[POINTER_CHANGE] 0x64cd886b1d10.right=0
[POINTER_CHANGE] 0x64cd886b1d50.left=0x64cd886b1d10
[ROOT_CHANGE] old=0x64cd886b1d10 new=0x64cd886b1d50</pre>
            <button onclick="loadAVLTreeSample()">Load Real AVL Tree Logs</button>
        </div>
    </div>
    
    <div class="test-container">
        <h2>Tree Visualization</h2>
        <div id="tree-display" class="tree-display"></div>
    </div>
    
    <div class="test-container">
        <h2>Debug Log</h2>
        <div id="log-output" class="log-output"></div>
    </div>

    <!-- Load the actual parser and animation files -->
    <script src="js/parserBTree.js"></script>
    <script src="js/parserAVLTree.js"></script>
    <script src="js/animation.js"></script>
    
    <script>
        // Global variables
        let btreeParser = null;
        let avlParser = null;
        let treeAnimation = null;
        
        // Logging function
        function log(message) {
            console.log(message);
            const logOutput = document.getElementById('log-output');
            const logEntry = document.createElement('div');
            logEntry.textContent = new Date().toLocaleTimeString() + ': ' + message;
            logOutput.appendChild(logEntry);
            logOutput.scrollTop = logOutput.scrollHeight;
        }
        
        // Clear functions
        function clearTree() {
            const container = document.getElementById('tree-display');
            container.innerHTML = '';
            log('Tree cleared');
        }
        
        function clearLog() {
            document.getElementById('log-output').innerHTML = '';
        }
        
        // Initialize parsers and animation
        function initializeSystems() {
            log('Initializing parsers and animation...');
            
            try {
                btreeParser = new BTreeParser();
                log('BTreeParser created successfully');
            } catch (error) {
                log('Error creating BTreeParser: ' + error.message);
            }
            
            try {
                avlParser = new AVLTreeParser();
                log('AVLTreeParser created successfully');
            } catch (error) {
                log('Error creating AVLTreeParser: ' + error.message);
            }
            
            try {
                treeAnimation = new TreeAnimation('tree-display', 'btree');
                log('TreeAnimation created successfully');
            } catch (error) {
                log('Error creating TreeAnimation: ' + error.message);
            }
        }
        
        // Test B-Tree parsing
        function testBTreeParsing() {
            log('=== TESTING B-TREE PARSING ===');
            
            if (!btreeParser) {
                log('BTreeParser not initialized!');
                return;
            }
            
            const testLogs = [
                '[TREE_INIT] order=3',
                '[NODE_CREATE] id=1 keys=[5] isLeaf=true',
                '[ROOT_CHANGE] newRoot=1',
                '[NODE_CREATE] id=2 keys=[3,7] isLeaf=false',
                '[PARENT_CHILD] parent=2 child=1',
                '[ROOT_CHANGE] newRoot=2'
            ];
            
            log('Processing B-Tree test logs...');
            testLogs.forEach((logLine, index) => {
                log(`Processing log ${index + 1}: ${logLine}`);
                btreeParser.parseLog(logLine);
            });
            
            const root = btreeParser.getRoot();
            log('B-Tree root after parsing: ' + JSON.stringify(root, null, 2));
            
            // Test tree animation
            if (treeAnimation) {
                treeAnimation.currentTree = root;
                treeAnimation.renderTree();
                log('B-Tree rendered in animation system');
            }
        }
        
        // Test AVL Tree parsing
        function testAVLTreeParsing() {
            log('=== TESTING AVL TREE PARSING ===');
            
            if (!avlParser) {
                log('AVLTreeParser not initialized!');
                return;
            }
            
            const testLogs = [
                '[ROOT_CREATE] id=1 data=5',
                '[NODE_CREATE] id=2 data=3',
                '[POINTER_CHANGE] node=1 left=2',
                '[NODE_CREATE] id=3 data=7',
                '[POINTER_CHANGE] node=1 right=3'
            ];
            
            log('Processing AVL Tree test logs...');
            testLogs.forEach((logLine, index) => {
                log(`Processing log ${index + 1}: ${logLine}`);
                avlParser.parseLog(logLine);
            });
            
            const root = avlParser.getRoot();
            log('AVL Tree root after parsing: ' + JSON.stringify(root, null, 2));
            
            // Test tree animation
            if (treeAnimation) {
                treeAnimation.setTreeType('avltree');
                treeAnimation.currentTree = root;
                treeAnimation.renderTree();
                log('AVL Tree rendered in animation system');
            }
        }
        
        // Test custom logs
        function testCustomLogs() {
            log('=== TESTING CUSTOM LOGS ===');
            
            const customLogs = document.getElementById('custom-logs').value;
            if (!customLogs.trim()) {
                log('No custom logs provided');
                return;
            }
            
            const logLines = customLogs.split('\n').filter(line => line.trim());
            log(`Processing ${logLines.length} custom log lines...`);
            
            // Determine tree type from logs
            const isBTree = logLines.some(line => line.includes('[NODE_STATE]') || line.includes('[TREE_INSERT_COMPLETE]') || line.includes('[Split Keys]'));
            const isAVLTree = logLines.some(line => line.includes('[ROOT_CREATE]') || line.includes('[POINTER_CHANGE]') || line.includes('[DATA_CHANGE]'));
            
            if (isBTree) {
                log('Detected B-Tree logs');
                if (btreeParser) {
                    logLines.forEach((logLine, index) => {
                        log(`Processing log ${index + 1}: ${logLine}`);
                        btreeParser.parseLog(logLine);
                    });
                    
                    const root = btreeParser.getRoot();
                    log('Custom B-Tree root: ' + JSON.stringify(root, null, 2));
                    
                    if (treeAnimation) {
                        treeAnimation.setTreeType('btree');
                        treeAnimation.currentTree = root;
                        treeAnimation.renderTree();
                    }
                }
            } else if (isAVLTree) {
                log('Detected AVL Tree logs');
                if (avlParser) {
                    logLines.forEach((logLine, index) => {
                        log(`Processing log ${index + 1}: ${logLine}`);
                        avlParser.parseLog(logLine);
                    });
                    
                    const root = avlParser.getRoot();
                    log('Custom AVL Tree root: ' + JSON.stringify(root, null, 2));
                    
                    if (treeAnimation) {
                        treeAnimation.setTreeType('avltree');
                        treeAnimation.currentTree = root;
                        treeAnimation.renderTree();
                    }
                }
            } else {
                log('Could not determine tree type from logs');
            }
        }
        
        // Parse custom logs from textarea
        function parseCustomLogs() {
            testCustomLogs();
        }
        
        // Load sample logs
        function loadBTreeSample() {
            const sample = document.getElementById('btree-sample').textContent;
            document.getElementById('custom-logs').value = sample;
            log('B-Tree sample loaded');
        }
        
        function loadAVLTreeSample() {
            const sample = document.getElementById('avltree-sample').textContent;
            document.getElementById('custom-logs').value = sample;
            log('AVL Tree sample loaded');
        }
        
        function loadRealLogsSample() {
            const sample = document.getElementById('real-logs-sample').textContent;
            document.getElementById('custom-logs').value = sample;
            log('Real server logs sample loaded');
        }
        
        function loadFullBTreeLogs() {
            // This would load the full logs.txt file - for now just use the sample
            const sample = document.getElementById('real-logs-sample').textContent;
            document.getElementById('custom-logs').value = sample;
            log('Full B-Tree logs loaded (sample)');
        }
        
        function loadFullAVLLogs() {
            // This would load the full logs2.txt file - for now just use the sample
            const sample = document.getElementById('avltree-sample').textContent;
            document.getElementById('custom-logs').value = sample;
            log('Full AVL Tree logs loaded (sample)');
        }
        
        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            log('Log parsing test page loaded');
            initializeSystems();
            log('Ready to test log parsing and tree visualization!');
        });
    </script>
</body>
</html>
